#!/usr/bin/env bash
# Configure Nginx to run as nginx user and listen on port 8080

# Update nginx.conf

sed -i 's|^\s*#?user .*;|user nginx;|' /etc/nginx/nginx.conf
sed -i 's|^\s*pid .*;|pid /tmp/nginx.pid;|' /etc/nginx/nginx.conf

# Update default site to listen on port 8080 (IPv4 & IPv6)

sed -i 's|listen 80 default_server;|listen 8080 default_server;|' /etc/nginx/sites-available/default
sed -i 's|listen [::]:80 default_server;|listen [::]:8080 default_server;|' /etc/nginx/sites-available/default

# Fix ownership and permissions

chown -R nginx:nginx /var/lib/nginx /var/log/nginx /tmp
chmod 755 /tmp
chmod 755 /etc/nginx
chmod 644 /etc/nginx/nginx.conf

# Stop any running Nginx or Apache processes

pkill -9 nginx || true
pkill -9 apache2 || true

# Start Nginx
service nginx restart
sleep 2  
